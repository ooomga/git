!function(d){"use strict";var z="ht",w=d[z],A=w.Default,D=Math,e=D.PI,h=2*e,s=D.sin,Y=D.cos,y=D.atan2,c=D.sqrt,E=D.max,r=D.floor,$=(D.round,D.ceil),j=D.abs,i=w.Shape,K=w.Edge,q=w.List,L=w.Style,B=w.graph,k=A.getInternal(),v=k.ui(),g=null,b="__segmentLengths",l="__lineTotalLength",X="__linePoints",N="__distance0",G="flow.count",n="flow.step",P="flow.element.max",x="flow.element.count",I="flow.element.min",W="flow.element.space",m="flow.element.autorotate",o="flow.element.background",J="flow.element.shadow.max",f="flow.element.shadow.min",V="flow.element.shadow.begincolor",t="flow.element.shadow.endcolor",F="flow.element.shadow.visible",U="flow.element.image",H="flow",O="prototype",u=function(o){return document.createElement(o)},M=function(o){for(var R=0,x=o.length-1,H=0;x>H;H++){var V=o[H],Y=o[H+1],v=Y.x-V.x,F=Y.y-V.y,j=c(v*v+F*F);R+=j}return R},R=function(F,D){for(var J=0,L=0,P=0,I=F.length-1,O=0;I>O;O++){var i=F[O],k=F[O+1],r=k.x-i.x,N=k.y-i.y;if(P=c(r*r+N*N),J+=P,J>D){J-=P,L=O;break}}var X=F[L],G=F[L+1],l=y(G.y-X.y,G.x-X.x),R=D-J,N=s(l)*R,r=Y(l)*R;return{x:X.x+r,y:X.y+N}},C=function(d,a,K,J){var u=Y(J),Q=s(J),m=u*a-Q*K,l=Q*a+u*K;return d?{x:d.x+m,y:d.y+l}:{x:m,y:l}},T=function(t,Q){t[b]=t[l]=t[X]=Q[N]=g},Z=function(Q,p,R,f,B,U){var i,g,v,M,Z,r,H,O,T,I,x,K=[];if(j(f)>h&&(f=h),Z=$(j(f)/(e/4)),i=f/Z,g=-i,v=-R,Z>0){r=Q+Y(R)*B,H=p+s(-R)*U,K.push({x:r,y:H});for(var n=0;Z>n;n++)v+=g,M=v-g/2,O=Q+Y(v)*B,T=p+s(v)*U,I=Q+Y(M)*(B/Y(g/2)),x=p+s(M)*(U/Y(g/2)),K.push({x:I,y:x}),K.push({x:O,y:T})}return K},_=function(B){var D,Q,a=B._data;if(a instanceof i){if(D=a.getPoints(),Q=a.getSegments(),(!Q||0===Q.size())&&D){Q=new w.List([1]);for(var O=1;O<D.size();O++)Q.add(2)}}else if(a instanceof K){var F=B._78o;if(F){var v=F.type,o=F.points,E=F.segments,H=F._4O;if(!v||o){var f=F._69o,T=f.x,g=f.y,y=F._70o,J=y.x,L=y.y;if(v)E?(D=new q({x:T,y:g}),D.addAll(o),D.add({x:J,y:L}),Q=new q(E._as)):(D=new q({x:T,y:g}),Q=new q([1]),o.each(function(G){D.add(G),Q.add(2)}),D.add({x:J,y:L}),Q.add(2));else if(F.looped){D=new q(Z(T,g,0,h,F.radius,F.radius)),Q=new q([1]);for(var O=0;O<(D.size()-1)/2;O++)Q.add(3)}else D=new q,F.center?(D.add({x:F.c1.x,y:F.c1.y}),D.add({x:T,y:g}),D.add({x:J,y:L}),D.add({x:F.c2.x,y:F.c2.y}),Q=new q([1,2,2,2])):(D.add({x:T,y:g}),D.add({x:J,y:L}),Q=new q([1,2]))}else if(H)if(D=new q(H.points._as),H.segments)Q=new q(H.segments._as);else{Q=new q([1]);for(var O=1;O<H.points.size();O++)Q.add(2)}}}if(D&&Q){for(var d=k.toPointsArray(D._as,Q._as,50),_=d.length,I=[],O=0;_>O;O++){var C=d[O];C.length>1&&I.push(d[O])}a.s("flow.reverse")&&(I.reverse(),I.forEach(function(H){H.reverse()}));for(var e=0,t=[],S=I.length,O=0;S>O;O++){var C=I[O],n=M(C);e+=n,t.push(n)}if(a[b]=t,a[l]=e,a[X]=I,a instanceof K){var G=A.unionPoint(I),U=G.x+G.width/2,R=G.y+G.height/2;a.$10e={x:U,y:R}}p(B,!0)}},p=function(Y,p){var h=Y._data,R=h[l],Z=h.s(G),e=h.s(n),B=0,s=h[b],U=h.s(P),y=h.s(I),o=h.s(x),X=(U-y)/(o-1),H=[];if(s){if(1===o)H.push(U);else if(2===o)H.push(U),H.push(y);else{if(!(o>2))return;H.push(U);for(var j=o-2;j>0;j--)H.push(y+X*j);H.push(y)}var m=0,M=0;H.forEach(function(W){o-1>m&&(M+=h.getFlowElementSpace(W)),m++}),M+=(U+y)/2,B=(R-Z*M+M)/Z;var E=Y[N];for(null==E&&(E=0),p||(E+=e);E>R+M;){var t=Y._overCount;t?t++:t=1,t>=Z&&(t=null),Y._overCount=t,h.s("flow.autoreverse")?t?E-=B+M:(E=0,h.s("flow.reverse",!h.s("flow.reverse"))):E-=B+M}Y[N]=E}},S=function(A){var I=A.data,T=this.dm();if(I&&"add"===A.kind){var p=T.$3e;p&&I.s(H)&&p.indexOf(I)<0&&p.push(I)}"clear"===A.kind&&(T.$3e=[])},a=function(V){var N=V.property,q=V.data,$=V.newValue,b=this.dm().$3e;if(b&&"s:flow"===N)if($)b.indexOf(q)<0&&b.push(q);else for(var h=b.length,P=0;h>P;P++)if(b[P]===q){b.splice(P,1);break}},Q=function(r,K){for(var v=0,h=K.length,b=0;h>b;b++){var p=K[b];if(v+=p,v>r)return b}return b},zh=function(Y){var _=this,a=_._data,$=a[l],D=a[b],H=a[X],B=a.s(G),u=0,K=_[N],k=a.s(P),T=a.s(I),t=a.s(x),v=a.s(f),V=a.s(J),d=a.s(m),S=(V-v)/(t-1),O=(k-T)/(t-1),r=a.getRotation?a.getRotation():0,U=a.getPosition?a.p():a.$10e,j=[],w=[];if(K!=g){if(1===t)j.push(k);else if(2===t)j.push(k),j.push(T);else{if(!(t>2))return;j.push(k);for(var s=t-2;s>0;s--)j.push(T+O*s);j.push(T)}if(1===t)w.push(V);else if(2===t)w.push(V),w.push(v);else{if(!(t>2))return;w.push(V);for(var s=t-2;s>0;s--)w.push(v+S*s);w.push(v)}var p=0,o=0;j.forEach(function(Q){t-1>p&&(o+=a.getFlowElementSpace(Q)),p++}),o+=(k+T)/2,u=($-B*o+o)/B,Y.save();for(var s=0;B>s;s++){var W=K,Z=0,z=_._overCount,n=0;a.s("flow.autoreverse")&&z&&z>B-(s+1)||(W-=s*(u+o),p=0,j.forEach(function(X){var h=W-Z;if(h>=0&&$>h){var L=!0,O=Q(h,D);n=0;for(var s=0;O>s;s++)n+=D[s];if(h-=n,L){var u=R(H[O],h),g=r;if(d){for(var S=H[O],f=0,V=0,B=0;B<S.length-1;B++){var K=S[B],J=S[B+1],i=J.x-K.x,e=J.y-K.y,x=c(i*i+e*e);if(f+=x,f>h){V=B;break}}var q=S[V];g+=y(u.y-q.y,u.x-q.x)}r&&(u=C(U,u.x-U.x,u.y-U.y,r)),_.$5e(Y,u,X,w[p],g)}}Z+=a.getFlowElementSpace(j[p]),p++}))}Y.restore()}},An=B.GraphView[O],_q=w.Data[O],Ai=v.DataUI[O],kk=v.ShapeUI[O],Kk=v.EdgeUI[O],qe=w.DataModel[O],tl=kk._80o,vr=Kk._80o,hn=qe.prepareRemove,Sl=Kk._79o,lb=kk._79o,Il=An.setDataModel,Jc=function(){var k=this,e=k._data,R=e.s(P),w=!1,b=g;if(k._6I||(w=!0),b=e instanceof K?Sl.call(k):lb.call(k),e.s(H)&&w){var v=e.s(J),V=e.s(F);V&&v>R&&(R=v),R>0&&A.grow(b,$(R/2)),_(k)}return!e.s(H)&&w&&T(e,k),b};_q.getFlowElementSpace=function(){return this.s(W)},kk._79o=Jc,Kk._79o=Jc,L[P]==g&&(L[P]=7),L[I]==g&&(L[I]=0),L[G]==g&&(L[G]=1),L[n]==g&&(L[n]=3),L[x]==g&&(L[x]=10),L[W]==g&&(L[W]=3.5),L[m]==g&&(L[m]=!1),L[o]==g&&(L[o]="rgba(255, 255, 114, 0.4)"),L[V]==g&&(L[V]="rgba(255, 255, 0, 0.3)"),L[t]==g&&(L[t]="rgba(255, 255, 0, 0)"),L[F]==g&&(L[F]=1),L[J]==g&&(L[J]=22),L[f]==g&&(L[f]=4),qe.prepareRemove=function(v){hn.call(this,v);var T=v._dataModel,d=T.$3e;if(d)for(var R=d.length,I=0;R>I;I++)if(d[I]===v){d.splice(I,1);break}},An.setDataModel=function($){var g=this,q=g._dataModel;if(q!==$){q&&(q.umm(S,g),q.umd(a,g),q.$3e=[]),$.mm(S,g),$.md(a,g);var s=$.$3e=[];$.each(function(W){W.s(H)&&s.indexOf(W)<0&&s.push(W)}),Il.call(g,$)}},An.setFlowInterval=function(y){var C=this,H=C.$11e;C.$11e=y,C.fp("flowInterval",H,y),C.$7e!=g&&(clearInterval(C.$7e),delete C.$7e,C.enableFlow(y))},An.getFlowInterval=function(){return this.$11e},An.$9e=function(){var _,J,a,H=this,p=H.tx(),f=H.ty(),h=H.getZoom(),l=H.getWidth(),Y=H.getHeight(),N={x:-p/h,y:-f/h,width:l/h,height:Y/h},Z=H.dm().$3e,m=H._56I,W=new q;if(Z.forEach(function(b){m[b.getId()]&&(_=H.getDataUI(b),_&&(a=_._79o(),a&&W.add(a)))}),0!==W.size()&&(W.each(function($){A.intersectsRect(N,$)&&(J=A.unionRect(J,$))}),J&&(J&&(A.grow(J,E(1,1/h)),J.x=r(J.x*h)/h,J.y=r(J.y*h)/h,J.width=$(J.width*h)/h,J.height=$(J.height*h)/h,J=A.intersection(N,J)),J))){var I=H._canvas.getContext("2d");I.save(),I.lineCap=A.lineCap,I.lineJoin=A.lineJoin,k.translateAndScale(I,p,f,h),I.beginPath(),I.rect(J.x,J.y,J.width,J.height),I.clip(),I.clearRect(J.x,J.y,J.width,J.height),H.$6e(I,J),I.restore()}},An.$6e=function(y,L){var C,i,W=this;W._93db(y),W.each(function(o){W._56I[o._id]&&(C=W.getDataUI(o),C&&(i=C._79o(),(!L||A.intersectsRect(L,i))&&C._42(y)))}),W._92db(y)},An.enableFlow=function(B){var A=this,K=A.dm(),E=K.$3e;A.$7e==g&&(E.forEach(function(o){var s=A.getDataUI(o);_(s)}),A.$7e=setInterval(function(){K.$3e.forEach(function(u){p(A.getDataUI(u))}),A.$9e()},B||A.$11e||50))},An.disableFlow=function(){var l=this;clearInterval(l.$7e),delete l.$7e;var n=l.dm().$3e;n&&l.$9e()},Ai.$5e=function(T,H,Y,w,$){var m=this,p=m._data,S=m.gv,f=p.s(o),_=p.s(V),P=p.s(t),C=p.s(F),j=S.$8e,Z=p.s(U);if(j==g&&(j=S.$8e={}),T.beginPath(),Z!=g){var N=A.getImage(Z),r=Y/2;T.translate(H.x,H.y),T.rotate($),T.translate(-H.x,-H.y),A.drawImage(T,N,H.x-r,H.y-r,Y,Y,p),T.translate(H.x,H.y),T.rotate(-$),T.translate(-H.x,-H.y)}else T.fillStyle=f,T.arc(H.x,H.y,Y/2,0,h,!0),T.fill();if(C){var O=22,i=O+"_"+_+"_"+P,q=j[i];if(q==g){var d=u("canvas");k.setCanvas(d,O,O);var L=d.getContext("2d"),n=O/2,R=n,J=n;k.translateAndScale(L,0,0,1),L.beginPath();var c=L.createRadialGradient(R,J,0,R,R,n);c.addColorStop(0,_),c.addColorStop(1,P),L.fillStyle=c,L.arc(R,J,n,0,h,!0),L.fill(),q=j[i]=d}var r=w/2;A.drawImage(T,q,H.x-r,H.y-r,w,w,p)}},Kk._80o=function(b){vr.call(this,b);var e=this,M=e._data,O=e.gv;M.s(H)&&O.$7e!=g&&zh.call(e,b)},kk._80o=function(e){tl.call(this,e);var r=this,Y=r._data,L=r.gv;Y.s(H)&&L.$7e!=g&&zh.call(r,e)}}(this,Object);