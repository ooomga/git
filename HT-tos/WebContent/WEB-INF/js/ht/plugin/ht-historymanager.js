!function(I,T){"use strict";var c="ht",W=I[c],d=W.Default,P=d.def,D="add",M="remove",l=d.getInternal(),N="propertyChange";W.HistoryManager=function(G){this._histories=[],this.setDataModel(G)},P(W.HistoryManager,T,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var n=this;n.$4p++,1===n.$4p&&(n.$3p=[])},endInteraction:function(){var q=this,U=q._histories,$=q._historyIndex,i=q.$3p;q.$4p--,0===q.$4p&&(delete q.$3p,i.length&&(U=U.slice(0,$+1),U.push(i),U.length>q._maxHistoryCount&&(U=U.slice(U.length-q._maxHistoryCount)),q.setHistories(U),q.setHistoryIndex(U.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(L){var E=this,S=E._dataModel;S!==L&&(S&&(delete S._historyManager,S.umm(E.$5p,E),S.umd(E.$6p,E)),E._dataModel=L,L._historyManager=E,L.mm(E.$5p,E),L.md(E.$6p,E),E.fp("dataModel",S,L),E.clear())},setHistoryIndex:function(Y,$){var A=this,P=A._historyIndex,L=A._histories.length;if(-1>Y?Y=-1:Y>=L&&(Y=L-1),P!==Y){if(!$){var i=Y-P;i>0?A.$2p(i):0>i&&A.$1p(-i)}A._historyIndex=Y,A.fp("historyIndex",P,Y)}},setMaxHistoryCount:function(X){var S=this,B=S._histories,C=S._maxHistoryCount;(!X||0>=X)&&(X=10),C!==X&&(S._maxHistoryCount=X,S.fp("maxHistoryCount",C,X),B.length>X&&S.clear())},$5p:function(z){if(!this.$7p&&!this.$8p){var Y,v,b=this,i=b._histories,r=z.kind,s=z.property,C=b._historyIndex;if(r===D||r===M?v={type:z.kind,data:z.data}:s&&"children"!==s&&"attaches"!==s&&"shape"!==s&&(v={type:N,data:z.data,property:s,oldValue:z.oldValue,newValue:z.newValue}),v)if(b.$4p){Y=b.$3p;var k=!1;if(v.type===N)for(var W=Y.length-1;W>=0;W--){var B=Y[W];if(B.type!==N)break;v.property===B.property&&B.property&&v.data===B.data&&(v.oldValue=B.oldValue,Y[W]=v,k=!0)}k||Y.push(v)}else Y=[v],i=i.slice(0,C+1),i.push(Y),i.length>b._maxHistoryCount&&(i=i.slice(i.length-b._maxHistoryCount)),b.setHistories(i),b.setHistoryIndex(i.length-1,!0)}},$6p:function(P){this.$5p(P)},undo:function(a){(!a||0>=a)&&(a=1),this.setHistoryIndex(this._historyIndex-a)},$1p:function(T){var _,$=this,s=$._dataModel,S=$._histories,z=$._historyIndex;for($.$7p=1,d.setIsolating(!0);T>0;){if(z>=0&&z<S.length){_=S[z],z--;for(var h=_.length-1;h>=0;h--){var w=_[h],V=w.type,k=w.data,v=w.property,J=w.oldValue;if(V===D)s.remove(k);else if(V===M)s.add(k);else{var p=null;0===v.indexOf("a:")?(p="attr",v=v.replace("a:","")):0===v.indexOf("s:")&&(p="style",v=v.replace("s:","")),l.setPropertyValue(k,p,v,J)}}}T--}d.setIsolating(!1),delete $.$7p},redo:function(n){(!n||0>=n)&&(n=1),this.setHistoryIndex(this._historyIndex+n)},$2p:function(y){var P,r=this,i=r._dataModel,K=r._histories,u=r._historyIndex;for(r.$7p=1,d.setIsolating(!0);y>0;){if(u>=-1&&u<K.length-1){u++,P=K[u];for(var x=0;x<P.length;x++){var G=P[x],e=G.type,R=G.data,I=G.property,F=G.newValue;if(e===D)i.add(R);else if(e===M)i.remove(R);else{var c=null;0===I.indexOf("a:")?(c="attr",I=I.replace("a:","")):0===I.indexOf("s:")&&(c="style",I=I.replace("s:","")),l.setPropertyValue(R,c,I,F)}}}y--}d.setIsolating(!1),delete r.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);