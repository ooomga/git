!function(D,j){"use strict";var J=ht.AlarmSeverity=function(w,t,a,V,z){this.value=w,this.name=t,this.nickName=a,this.color=V,this.displayName=z};ht.Default.def("ht.AlarmSeverity",j,{toString:function(){return this.displayName||this.name}}),function(){J.severities=new ht.List,J._vm={},J._nm={},J._cp=function(A,W){if(A&&W){var d=A.value-W.value;return d>0?1:0>d?-1:0}return A&&!W?1:!A&&W?-1:0},J.each=function(x,m){J.severities.each(x,m)},J.getSortFunction=function(){return J._cp},J.setSortFunction=function(A){J._cp=A,J.severities.sort(A)},J.add=function(F,d,n,h,M){var v=new J(F,d,n,h,M);return J._vm[F]=v,J._nm[d]=v,J.severities.add(v),J.severities.sort(J._cp),v},J.remove=function(V){var S=J._nm[V];return S&&(delete J._nm[V],delete J._vm[S.value],J.severities.remove(S)),S},J.CRITICAL=J.add(500,"Critical","C","#FF0000"),J.MAJOR=J.add(400,"Major","M","#FFA000"),J.MINOR=J.add(300,"Minor","m","#FFFF00"),J.WARNING=J.add(200,"Warning","W","#00FFFF"),J.INDETERMINATE=J.add(100,"Indeterminate","N","#C800FF"),J.CLEARED=J.add(0,"Cleared","R","#00FF00"),J.isClearedAlarmSeverity=function(B){return B?0===B.value:!1},J.getByName=function(q){return J._nm[q]},J.getByValue=function(V){return J._vm[V]},J.clear=function(){J.severities.clear(),J._vm={},J._nm={}},J.compare=function(b,x){return J._cp(b,x)}}();var C=ht.AlarmState=function(x){this._d=x,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",j,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var y=null;for(var $ in this._am)$=J.getByName($),J.isClearedAlarmSeverity($)||0!==this.getAcknowledgedAlarmCount($)&&(y=y?J.compare(y,$)>0?y:$:$);this._haa=y},_c2:function(){var I=null;for(var u in this._nm)u=J.getByName(u),J.isClearedAlarmSeverity(u)||0!==this.getNewAlarmCount(u)&&(I=I?J.compare(I,u)>0?I:u:u);this._hna=I},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var i in this._nm)if(i=J.getByName(i),!J.isClearedAlarmSeverity(i)&&0!==this.getNewAlarmCount(i)&&J.compare(this._hna,i)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var S=this._haa,C=this._hna,K=this._ps;this._hoa=S,J.compare(C,this._hoa)>0&&(this._hoa=C),J.compare(K,this._hoa)>0&&(this._hoa=K)},_c5:function(){var $=this._haa,T=this._hna;this._hta=$,J.compare(T,this._hta)>0&&(this._hta=T)},increaseAcknowledgedAlarm:function(D,c){if(0!==c){c=c||1;var f=this._am[D.name]||0;f+=c,this._am[D.name]=f,this._f()}},increaseNewAlarm:function(V,D){if(0!==D){D=D||1;var p=this._nm[V.name]||0;p+=D,this._nm[V.name]=p,this._f()}},decreaseAcknowledgedAlarm:function(G,S){if(0!==S){S||(S=1);var X=this._am[G.name]||0;if(X-=S,0>X)throw"Alarm count can not be negative";this._am[G.name]=X,this._f()}},decreaseNewAlarm:function(z,y){if(0!==y){y||(y=1);var q=this._nm[z.name]||0;if(q-=y,0>q)throw"Alarm count can not be negative";this._nm[z.name]=q,this._f()}},acknowledgeAlarm:function(N){this.decreaseNewAlarm(N,1),this.increaseAcknowledgedAlarm(N,1)},acknowledgeAllAlarms:function(R){if(R){var X=this.getNewAlarmCount(R);this.decreaseNewAlarm(R,X),this.increaseAcknowledgedAlarm(R,X)}else for(var c in this._nm)this.acknowledgeAllAlarms(J.getByName(c))},_c6:function(){this._aac=0;for(var K in this._am)K=J.getByName(K),this._aac+=this.getAcknowledgedAlarmCount(K)},getAcknowledgedAlarmCount:function(Y){return Y?this._am[Y.name]||0:this._aac},getAlarmCount:function(N){return this.getAcknowledgedAlarmCount(N)+this.getNewAlarmCount(N)},_c7:function(){this._nac=0;for(var T in this._nm)this._nac+=this.getNewAlarmCount(J.getByName(T))},getNewAlarmCount:function($){return $?this._nm[$.name]||0:this._nac},setNewAlarmCount:function(E,J){this._nm[E.name]=J,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(X,B){this._am[X.name]=B,this._f()},removeAllAcknowledgedAlarms:function(n){n?delete this._am[n.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(q){if(this._ep||(q=null),this._ps!==q){var z=this._ps;this._ps=q,this._f(),this._d.fp("propagateSeverity",z,q)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var t=this._ep;this._ep=e,this._d.fp("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}});var o=ht.AlarmStatePropagator=function(g){this._dataModel=g,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",j,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(t){this._enable!==t&&(this._enable=t,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(J){this.propagate(J)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(V){V.data&&this.propagate(V.data)},handleDataPropertyChange:function(M){if("alarmState"===M.property||"enablePropagation"===M.property)this.propagate(M.data);else if("parent"===M.property){var i=M.oldValue;i&&this.propagate(i),this.propagate(M.data)}},propagate:function(p){p&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(p),this._isPropagating=!1)},propagateToTop:function(s){for(this.propagateToParent(null,s);s&&s.getParent();)this.propagateToParent(s,s.getParent()),s=s.getParent()},propagateToParent:function(x,F){var Z=null;F.getChildren().each(function(n){var B=n.getAlarmState().getHighestOverallAlarmSeverity();J.compare(B,Z)>0&&(Z=B)}),F.getAlarmState().setPropagateSeverity(Z)}}),ht.AlarmStateStatistics=function(r){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(r)},ht.Default.def("ht.AlarmStateStatistics",j,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(k){var F=this._dataModel;F!==k&&(F&&(F.umd(this.handleDataPropertyChange,this),F.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=k,this.reset(),k.md(this.handleDataPropertyChange,this),k.mm(this.handleDataModelChange,this),this.fp("dataModel",F,k))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(b){"alarmState"===b.property&&(this.increase(b.data),this.fireAlarmStateChange())},handleDataModelChange:function(V){"add"===V.kind?(this.increase(V.data),this.fireAlarmStateChange()):"remove"===V.kind?(this.decrease(V.data),this.fireAlarmStateChange()):"clear"===V.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,J.each(function(a){var g=this.getSumInfo(a);this.sumAcked+=g.ackedCount,this.sumNew+=g.newCount,this.sumTotal+=g.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(P){if(!P)return this.sumNew;var f=this.getSumInfo(P);return f.newCount},getAcknowledgedAlarmCount:function(H){if(!H)return this.sumAcked;var g=this.getSumInfo(H);return g.ackedCount},getTotalAlarmCount:function(n){if(!n)return this.sumTotal;var U=this.getSumInfo(n);return U.totalCount},getSumInfo:function(R){var _=this.severtiyMap[R.name];return _||(_={},_.newCount=0,_.ackedCount=0,_.totalCount=0,this.severtiyMap[R.name]=_),_},decrease:function(Y){var I=this.dataMap[Y.getId()];I&&(delete this.dataMap[Y.getId()],J.each(function(F){var k=I[F.name],Y=this.getSumInfo(F);Y.newCount=Y.newCount-k.newCount,Y.ackedCount=Y.ackedCount-k.ackedCount,Y.totalCount=Y.totalCount-k.totalCount},this))},increase:function(j){if(this.decrease(j),!this._filterFunc||this._filterFunc(j)){var S={},O=j.getAlarmState();this.dataMap[j.getId()]=S,J.each(function(g){var u={};u.newCount=O.getNewAlarmCount(g),u.ackedCount=O.getAcknowledgedAlarmCount(g),u.totalCount=O.getAlarmCount(g),S[g.name]=u;var G=this.getSumInfo(g);G.newCount=G.newCount+u.newCount,G.ackedCount=G.ackedCount+u.ackedCount,G.totalCount=G.totalCount+u.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(k){var B=this._filterFunc;this._filterFunc=k,this.reset(),this.firePropertyChange("filterFunc",B,k)},getFilterFunc:function(){return this._filterFunc}});var x=ht.Data.prototype;x.getAlarmState=function(){return this._alarmState||(this._alarmState=new C(this))},x=ht.DataModel.prototype,x.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},x.setEnableAlarmStatePropagator=function(k){k!=this.isEnableAlarmStatePropagator()&&(k?(this._alarmStatePropagator=new o(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},x=ht.graph.GraphView.prototype,x.getNote2=function(i){var M=i.getAlarmState().getHighestNewAlarmSeverity();if(M){var t=i.getAlarmState().getNewAlarmCount(M)+M.nickName;return i.getAlarmState().hasLessSevereNewAlarms()&&(t+="+"),t}return i.s("note2")},x.getNote2Background=function(I){var Z=I.getAlarmState().getHighestNewAlarmSeverity();return Z?Z.color:I.s("note2.background")},x.getBodyColor=function(m){var P=m.getAlarmState().getHighestNativeAlarmSeverity();return P?P.color:m.s("body.color")},x.getBorderColor=function(c){var U=c.getAlarmState().getPropagateSeverity();return U?U.color:c.s("border.color")},x=ht.widget.TreeView.prototype,x.getBorderColor=function(b){var M=b.getAlarmState().getPropagateSeverity();return M?M.color:b.s("border.color")},x.getIcon=function(Y){return Y.getIcon()?"__alarmIcon__":null},x=ht.widget.TreeTableView.prototype,x.getBorderColor=function(g){var y=g.getAlarmState().getPropagateSeverity();return y?y.color:g.s("border.color")},x.getIcon=function(w){return w.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(X){return X.getIcon()}},color:{func:function(e){var f=e.getAlarmState().getHighestNativeAlarmSeverity();return f?f.color:e.s("body.color")}},rect:[0,0,16,16]}]});var h=ht.Style;h["note2.expanded"]=!0,h["note2.color"]="#000"}(this,Object);